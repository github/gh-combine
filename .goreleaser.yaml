# yaml-language-server: $schema=https://goreleaser.com/static/schema.json
# vim: set ts=2 sw=2 tw=0 fo=cnqoj

version: 2

builds:
  - main: ./cmd/gh-combine # Default: `.`.
    dir: "."
    binary: gh-combine # Default: Project directory name.
    env:
      - CGO_ENABLED=0
      - GOPROXY=off
      - GOSUMDB=off
      - SOURCE_DATE_EPOCH={{ .CommitTimestamp }}
    flags:
      - -trimpath
      - -mod=vendor
      - -v
    goos:
      - linux
      - darwin
      - windows
      - freebsd
    ldflags:
      - -s -w -X github.com/github/gh-combine/internal/version.tag={{.Tag}} -X github.com/github/gh-combine/internal/version.commit={{.FullCommit}} -X github.com/github/gh-combine/internal/version.buildTime={{.CommitDate}}

archives:
  - formats:
      - binary
    meta: true
    # Archive name.
    #
    # Default:
    # - if format is `binary`:
    #   - `{{ .Binary }}_{{ .Version }}_{{ .Os }}_{{ .Arch }}{{ with .Arm }}v{{ . }}{{ end }}{{ with .Mips }}_{{ . }}{{ end }}{{ if not (eq .Amd64 "v1") }}{{ .Amd64 }}{{ end }}`
    # - if format is anything else:
    #   - `{{ .ProjectName }}_{{ .Version }}_{{ .Os }}_{{ .Arch }}{{ with .Arm }}v{{ . }}{{ end }}{{ with .Mips }}_{{ . }}{{ end }}{{ if not (eq .Amd64 "v1") }}{{ .Amd64 }}{{ end }}`
    # Templates: allowed.
    name_template: '{{ .Binary }}_{{ .Version }}_{{ .Os }}_{{ .Arch }}{{ with .Arm }}v{{ . }}{{ end }}{{ with .Mips }}_{{ . }}{{ end }}{{ if not (eq .Amd64 "v1") }}{{ .Amd64 }}{{ end }}'

# snapshots are used for testing and development purposes
# build snapshots with `goreleaser build --snapshot --clean`
snapshot:
  version_template: "{{ .Version }}-dev-{{.ShortCommit}}"

checksum:
  name_template: "checksums.txt"

changelog:
  use: github-native

report_sizes: true

release:
  draft: false
  include_meta: true

dist: "./dist"
